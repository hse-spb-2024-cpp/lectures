# macOS

Этот туториал написан в сентябре 2024 года на MacBook Air 13" 2018 года, macOS Sonoma 14.6.1, Intel i5, 8 ГБ памяти, 107 ГБ свободного места на диске (диск 128 ГБ показывается как 121 ГБ, 14 ГБ заняты системой и встроенными приложениями).

Инструкция также протестирована на MacBook Air 13" 2017 с macOS Monterey 12.7.6, Intel i5, 8 ГБ. Различия: Apple clang 14.0.0, git 2.37.1.

### Обновление macOS
Обновите macOS до последней версии (Sonoma 14.6.1).

Если у вас есть время, также рекомендуется переустановить систему, чтобы:
- не было неправильного или сломанного софта, из-за которого могут возникнуть непонятные ошибки
- было много места на жестком диске

Если у вас старый макбук и на нём невозможно установить последнюю версию макос, установите максимально последнюю, и продолжайте туториал. В конце запишите все различающиеся версии инструментов себе в сохранёнки, если будут возникать проблемы - говорите об этом практику.

На последней версии макос все версии инструментов должны совпадать.

### Устрановка инструментов разработчика xcode
Введите в терминале (откроется диалоговое окно вне терминала, нужно согласиться) (10 минут):

```
xcode-select --install
```

### Установка brew
Скачайте и установите файл `Homebrew-версия.pkg` внизу страницы с [гитхаба](https://github.com/Homebrew/brew/releases/latest).

Откройте приложение Терминал / Terminal.

Введите в терминале:
```
brew update
```

Если пишется `zsh: command not found: brew`, введите в терминал:

Для процессора Intel
```
echo 'eval "$(/usr/local/bin/brew shellenv)"' >> ~/.zprofile
```

Для процессора M1 и позднее
```
echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> ~/.zprofile
```

Переоткройте терминал. Теперь `brew update` должен работать.

### Установка вспомогательных инструментов
Введите в терминале (10 минут):
```
brew install llvm@15 cppcheck coreutils cmake boost
```

(Пакет coreutils содержит команду `timeout`, которая нужна для запуска локальных тестов.)

Введите в терминале и **переоткройте терминал**:
```
echo 'export PATH=$PATH:"$(brew --prefix llvm@15)/bin"' >> ~/.zprofile
```

Это добавит команды `clang-format` и `clang-tidy`.

git и make будут установлены вместе с xcode-select.

### Проверка
Проверьте, что вы установили правильные версии инструментов.

Эти версии актуальны для последней версии макос Sonoma 14.6.1. Если у вас другие версии, скорее всего вы забыли обновить макос перед началом установки. Обновите систему и повторите установку.

Нужно для каждой строчки скопировать в терминал команду до решеточки и убедиться, что вывод совпадает с текстом после решеточки.

```
clang++ --version  # Apple clang version 15.0.0 (clang-1500.3.9.4)

# Не должны меняться, привязаны к llvm@15
clang-format --version  # Homebrew clang-format version 15.0.7
clang-tidy --version  # Homebrew LLVM version 15.0.7

cppcheck --version  # Cppcheck 2.15.0
timeout --version  # timeout (GNU coreutils) 9.5
cmake --version  # cmake version 3.30.3

# Идут в комплекте с xcode-select
xcode-select --version  # xcode-select version 2408
git --version  # git version 2.39.3
make --version  # GNU Make 3.81

brew install boost  # должен выдавать boost 1.86.0 already installed
```

### Установка VSCode
Можно установить любой другой редактор кода. Не рекомендуется ставить CLion на ноуты с 8 ГБ памяти.

1. https://code.visualstudio.com/download

2. Создайте или откройте любой .cpp файл в VSCode, VS Code автоматически предложит установить расширение C/C++ Extension Pack - соглашайтесь. После установки он предложит перейти на pre-release version - отказывайтесь, будем пользоваться только стабильной версией.

3. Поставьте галочку File -> Auto Save, чтобы изменения в файлах сохранялись автоматически.

Мы будем пользоваться VSCode только как редактором кода, а компилировать, запускать автопроверки и запускать код будем в терминале.

### Запуск примерчика

Создайте в VSCode файл `sample.cpp`, сохраните его в домашнюю директорию.

```
#include <iostream>

int main() {
    std::cout << "hello" << std::endl;
    return 0;
}
```

Откройте терминал и выполните команду:
```
clang++ -std=c++17 -pedantic-errors -Wall -Wextra -Werror sample.cpp
```

Появится файл `a.out`, запустите его введя в терминал:
```
./a.out
```

Должно напечататься `hello`.

### Установка виртуальной машины с Ubuntu
ВМ, виртуалка, виртуальная машина - это одни и те же слова.

Во время прохождения домашек необходим инструмент профилирования памяти Valgrind. Его нельзя запустить на маке, поэтому нам необходима Ubuntu. Для доступа к Ubuntu нам необходимо скачать виртуальную машину и установить на нее Ubuntu.

#### Процессор Intel
Установите виртуальную машину [Oracle VirtualBox](https://www.virtualbox.org/wiki/Downloads) (macOS / Intel hosts).

Скачайте готовый образ с Ubuntu **22.04** от проекта OSboxes, разархивируйте его и перенесите файл .vdi из папки 64bit в саму папку Загрузки, а папку 64bit удалите.
- [Ubuntu Mate](https://www.osboxes.org/ubuntu-mate/) - для слабых ноутбуков, 8 ГБ памяти или для всех, если вы хотите, чтобы меньше тормозило.
- [Ubuntu](https://www.osboxes.org/ubuntu/) - для всех остальных.

Классическая Ubuntu и Ubuntu Mate будут различаться визуально, но вам нужно будет пользоваться практически только терминалом, поэтому это не важно.

Загрузите образ в VirtualBox: откройте приложение, нажмите Создать, имя ubuntu, память и процессор по максимуму, выберите пункт Использовать существующий виртуальный жесткий диск, нажмите на папочку и добавьте скачанный образ, выберите его. Готово. [Скриншоты](https://disk.yandex.ru/d/2j5IIm4hPzUCQg).

Запустите, дайте все разрешения, в верхнем меню выберите View -> Virtual Screen 1 -> Resize (выберите максимальный влезающий размер), и потом там же выберите Scale, после чего можно перейти в режим Full Screen. У меня на 13" это 1920х1200 и 150%.

#### Процессор M1 и позднее
Установите виртуальную машину [UTM](https://mac.getutm.app/).

Скачайте готовый образ с [Ubuntu **22.04**](https://mac.getutm.app/gallery/ubuntu-20-04), откройте его в приложении UTM.

(Опционально, низкий приоритет). Чтобы тестировать ваш код на большем количестве компиляторов, на M1+ можно также поставить [Windows for ARM на виртуальную машину UTM](https://mac.getutm.app/gallery/windows-10), после чего поставить в неё Visual Studio по инструкции для Windows. Это будет очень сильно тормозить, так как Visual Studio есть только для x86, а на ARM будет эмуляция.

#### Настройка ВМ
Пройдите полный туториал по настройке Ubuntu.

### Завершение
Удалите все лишние файлы из Загрузок, кроме образа с Ubuntu (11 ГБ) и самого приложения Visual Studio Code (600 MB). Архивы, в которых они были изначально скачаны, нужно удалить и почистить корзину.

### Особенности компиляции на маке с Apple Clang

Ничего делать не нужно, просто для информации.

Будьте осторожны: обычно на macOS используется Apple Clang (не LLVM Clang), который скрывается за командой gcc/g++ и ставится вместе с Apple-специфичной средой разработки Xcode или её консольной версией. Скорее всего, будет не та версия, что надо. Проверьте, запустив g++ --version.

При этом библиотеки для C++ (вроде Boost) надо либо собирать из исходников (долго и нудно), либо поставить уже собранные, но тогда они будут работать только с Apple Clang. Так что для ежедневной работы рекомендуется именно Apple Clang.

По умолчанию будет использоваться компилятор Apple Clang и стандартная библиотека Apple libc++. Не libstdc++, как на Linux, и даже не совсем LLVM libc++. Из-за этого и говорят, что "на маках компилируется, а под другими ОС нет", виновата другая стандартная библиотека.

brew install boost устанавливает Boost имеенно для Apple Clang. С gcc/llvm clang из Homebrew будет странно не компилироваться и/или странно падать.

## Шорткаты и полезные команды
`COMMAND + +` - увеличить размер текста в терминале.

Команды в терминале:
`ls` (list) - вывести список всех директорий (папок) и файлов в текущей директории

`cd` (change directory) - сменить директорию на указанную

## Успехов, всё получится! <3
Если эти инструкции звучат куча странных инструкций, то это так и есть :) Это станет чуть проще и понятнее со временем, главное продолжать двигаться.
